<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>CAX Corp — Private Dashboard</title>

<!-- Simple CSS, moderne et sobre -->
<style>
  :root{
    --bg:#0f1724; --card:#0b1220; --accent:#06b6d4; --muted:#94a3b8; --glass: rgba(255,255,255,0.03);
    font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }
  html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg),#071026);color:#e6eef6}
  .center {display:flex;align-items:center;justify-content:center;height:100%;}
  .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));backdrop-filter: blur(6px);
        border:1px solid rgba(255,255,255,0.03); padding:28px; border-radius:12px; width:980px; max-width:95%;}
  h1{margin:0 0 12px 0;font-size:20px;letter-spacing:0.2px}
  p.lead{margin:0 0 20px 0;color:var(--muted)}
  .inputs{display:flex;gap:12px;flex-wrap:wrap}
  input[type="password"], input[type="text"]{
    flex:1; min-width:220px; padding:12px 14px; border-radius:8px; border:1px solid rgba(255,255,255,0.04);
    background:transparent; color:inherit; outline:none; box-shadow: inset 0 1px 0 rgba(255,255,255,0.01);
  }
  button { background:linear-gradient(90deg,var(--accent),#3dd7e0); border:none; padding:11px 16px; border-radius:8px;
           color:#042028; font-weight:600; cursor:pointer;}
  button.ghost{background:transparent; color:var(--muted); border:1px solid rgba(255,255,255,0.03)}
  .hint{font-size:13px;color:var(--muted); margin-top:10px}
  /* Dashboard layout */
  .dash{display:none; gap:20px;}
  .grid{display:grid; grid-template-columns: 1fr 360px; gap:20px; margin-top:18px;}
  .panel{background:var(--card); padding:16px; border-radius:10px; border:1px solid rgba(255,255,255,0.02)}
  .small{font-size:13px;color:var(--muted)}
  .result{margin-top:12px;padding:12px;border-radius:8px}
  .ok{background:rgba(16,185,129,0.12); color:#a7f3d0}
  .bad{background:rgba(239,68,68,0.08); color:#ffb4b4}
  a.link{color:var(--accent); text-decoration:none;}
  footer{margin-top:18px;font-size:13px;color:var(--muted); text-align:right;}
  @media(max-width:900px){ .grid{grid-template-columns:1fr} }
</style>
</head>
<body>
  <div class="center">
    <div class="card" id="card">

      <!-- Login area -->
      <div id="loginArea">
        <h1>CAX Corp — Private Dashboard</h1>
        <p class="lead">Veuillez entrer le mot de passe pour accéder au tableau de bord privé.</p>

        <div class="inputs">
          <input id="passwordInput" type="password" placeholder="Password" autocomplete="off" />
          <button id="unlockBtn">Unlock</button>
          <button id="clearBtn" class="ghost">Clear</button>
        </div>
        <div class="hint">Entrez votre mot de passe personnel. Aucune donnée n'est envoyée au serveur.</div>
      </div>

      <!-- Dashboard template (masqué tant que pas authentifié) -->
      <div id="dashboard" class="dash" aria-hidden="true">
        <h1>Welcome, Monsieur — CAX Private</h1>
        <p class="lead">Tableau de bord — ressources et outils privés.</p>

        <div class="grid">
          <!-- Left column: main tools -->
          <div>
            <!-- License checker -->
            <div class="panel">
              <h3>License Checker</h3>
              <p class="small">Enter a Gumroad license key to verify status.</p>
              <div style="display:flex;gap:8px;margin-top:10px;flex-wrap:wrap;">
                <input id="licenseKey" type="text" placeholder="Paste license key here" />
                <button id="checkBtn">Verify</button>
              </div>
              <div id="checkResult" class="result" style="display:none"></div>
              <div class="small" style="margin-top:10px">Product ID used: <span id="productIdDisplay"></span></div>
            </div>

            <!-- Notes / quicklinks -->
            <div class="panel" style="margin-top:14px">
              <h3>Quick Links & Notes</h3>
              <ul>
                <li><a class="link" href="resources/example.pdf" target="_blank">Example PDF</a></li>
                <li><a class="link" href="#" id="openRepo">Open GitHub repo</a></li>
              </ul>
              <p class="small" style="margin-top:8px">Vous pouvez ajouter d'autres ressources dans /resources/</p>
            </div>
          </div>

          <!-- Right column: info / actions -->
          <div>
            <div class="panel">
              <h4>Account</h4>
              <p class="small">Logged as: <strong>Monsieur</strong></p>
              <div style="margin-top:12px;display:flex;gap:8px;">
                <button id="logoutBtn" class="ghost">Logout</button>
                <button id="reloadBtn" class="ghost">Reload page</button>
              </div>
            </div>

            <div class="panel" style="margin-top:12px">
              <h4>System</h4>
              <p class="small">Status: <span id="statusVar">Ready</span></p>
              <p class="small" style="margin-top:8px">HTTPS recommended. Fichiers: <code>/index.html</code>, <code>/resources/</code></p>
            </div>
          </div>
        </div>

        <footer>© CAX Corporation</footer>
      </div>

      <!-- Hidden template to prevent dashboard from rendering before auth -->
      <template id="dashboardTemplate">
        <!-- content already present in #dashboard, template kept for clarity -->
      </template>

    </div>
  </div>

  <!-- Script: auth + license checker -->
  <script>
    // ********* CONFIGURATION - remplacez ici *********
    const PASSWORD = "replace_with_your_password";           // <-- changez le mot de passe ici
    const PRODUCT_ID = "replace_with_your_product_id";      // <-- changez le Gumroad product_id ici
    const GITHUB_REPO_URL = "https://github.com/cax-corp/intranet"; // facultatif
    // **************************************************

    // éléments DOM
    const passwordInput = document.getElementById('passwordInput');
    const unlockBtn = document.getElementById('unlockBtn');
    const clearBtn = document.getElementById('clearBtn');
    const loginArea = document.getElementById('loginArea');
    const dashboard = document.getElementById('dashboard');
    const productIdDisplay = document.getElementById('productIdDisplay');
    const checkBtn = document.getElementById('checkBtn');
    const licenseKeyInput = document.getElementById('licenseKey');
    const checkResult = document.getElementById('checkResult');
    const logoutBtn = document.getElementById('logoutBtn');
    const openRepo = document.getElementById('openRepo');
    const reloadBtn = document.getElementById('reloadBtn');

    // show product id
    productIdDisplay.textContent = PRODUCT_ID;

    // Unlock handler
    function unlock() {
      const v = passwordInput.value || "";
      if (v === PASSWORD) {
        // remove login, show dashboard
        loginArea.style.display = 'none';
        dashboard.style.display = 'block';
        dashboard.setAttribute('aria-hidden','false');
        // clear sensitive input
        passwordInput.value = "";
        // optionally store a session flag (keeps access until tab closed)
        sessionStorage.setItem('cax_auth','1');
      } else {
        // feedback
        passwordInput.value = "";
        passwordInput.focus();
        // petit shake visuel
        loginArea.animate([
          { transform: 'translateX(0px)' },
          { transform: 'translateX(-8px)' },
          { transform: 'translateX(8px)' },
          { transform: 'translateX(0px)' }
        ], { duration: 240 });
      }
    }

    // If previously authenticated in session, reveal
    if (sessionStorage.getItem('cax_auth') === '1') {
      loginArea.style.display = 'none';
      dashboard.style.display = 'block';
      dashboard.setAttribute('aria-hidden','false');
    }

    unlockBtn.addEventListener('click', unlock);
    passwordInput.addEventListener('keydown', (e) => { if (e.key === 'Enter') unlock(); });
    clearBtn.addEventListener('click', () => { passwordInput.value=''; passwordInput.focus(); });

    logoutBtn.addEventListener('click', () => {
      sessionStorage.removeItem('cax_auth');
      // reload to show login again
      location.reload();
    });

    openRepo.addEventListener('click', (e) => {
      e.preventDefault();
      window.open(GITHUB_REPO_URL, '_blank');
    });

    reloadBtn.addEventListener('click', () => location.reload());

    // ********* License checker *********
    async function verifyLicense() {
      const key = licenseKeyInput.value.trim();
      if (!key) {
        showResult('Enter a license key.', 'bad');
        return;
      }
      showResult('Checking…', ''); // neutral
      const form = new URLSearchParams();
      form.append('product_id', PRODUCT_ID);
      form.append('license_key', key);

      try {
        const resp = await fetch('https://api.gumroad.com/v2/licenses/verify', {
          method: 'POST',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
          body: form
        });
        const data = await resp.json();
        if (data && data.success) {
          const email = data.purchase && data.purchase.email ? data.purchase.email : 'unknown';
          showResult(`License valid — buyer: ${email}`, 'ok');
        } else {
          showResult('Invalid license key.', 'bad');
        }
      } catch (err) {
        console.error(err);
        showResult('Error contacting Gumroad API.', 'bad');
      }
    }

    function showResult(text, cls) {
      checkResult.style.display = 'block';
      checkResult.textContent = text;
      checkResult.className = 'result ' + (cls === 'ok' ? 'ok' : (cls === 'bad' ? 'bad' : ''));
    }

    checkBtn.addEventListener('click', verifyLicense);
    licenseKeyInput.addEventListener('keydown', (e) => { if (e.key === 'Enter') verifyLicense(); });

    // Prevent dashboard content from being focusable/tabbable while not authenticated
    // (already hidden by display:none - can be extended)
  </script>
</body>
</html>